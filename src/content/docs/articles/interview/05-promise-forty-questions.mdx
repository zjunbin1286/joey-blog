---
title: 40 é“ Promise è¾“å‡ºé¢˜ï¼Œä½ éƒ½ä¼šäº†å—ï¼ŸğŸ”¥
---

## 1. Promise ç¬¬ä¸€é¢˜
```js
const promise1 = new Promise((resolve, reject) => {
  console.log('promise1')
})

console.log('1', promise1)
```
**è§£æ**ï¼š
-   ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆé‡åˆ°`new Promise`ï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°ä¸­çš„ä»£ç `promise1`
-   ç„¶åæ‰§è¡ŒåŒæ­¥ä»£ç `1`ï¼Œæ­¤æ—¶`promise1`æ²¡æœ‰è¢«`resolve`æˆ–è€…`reject`ï¼Œå› æ­¤çŠ¶æ€è¿˜æ˜¯`pending`

**ç­”æ¡ˆ**ï¼š
```
promise1
1 Promise { <pending> }
```

## 2. Promise ç¬¬äºŒé¢˜
```js
const promise = new Promise((resolve, reject) => {
  console.log(1)
  resolve('success')
  console.log(2)
})

promise.then(() => {
  console.log(3)
})

console.log(4)
```
**è§£æ**ï¼š
-   ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆé‡åˆ°`new Promise`ï¼Œæ‰§è¡Œå…¶ä¸­çš„åŒæ­¥ä»£ç 1
-   å†é‡åˆ°`resolve('success')`ï¼Œ å°†promiseçš„çŠ¶æ€æ”¹ä¸ºäº†resolvedå¹¶ä¸”å°†å€¼ä¿å­˜ä¸‹æ¥
-   ç»§ç»­æ‰§è¡ŒåŒæ­¥ä»£ç 2
-   è·³å‡ºpromiseï¼Œå¾€ä¸‹æ‰§è¡Œï¼Œç¢°åˆ°`promise.then`è¿™ä¸ªå¾®ä»»åŠ¡ï¼Œå°†å…¶åŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—
-   æ‰§è¡ŒåŒæ­¥ä»£ç 4
-   æœ¬è½®å®ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œæ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç°`promise.then`è¿™ä¸ªå¾®ä»»åŠ¡ä¸”çŠ¶æ€ä¸ºresolvedï¼Œæ‰§è¡Œå®ƒã€‚

**ç­”æ¡ˆ**ï¼š1ã€2ã€4ã€3

## 3. Promise ç¬¬ä¸‰é¢˜
```js
const promise = new Promise((resolve, reject) => {
  console.log(1)
  console.log(2)
})

promise.then(() => {
  console.log(3)
})

console.log(4)
```
**è§£æ**ï¼š
-   å’Œã€Promiseç¬¬äºŒé¢˜ã€‘ç›¸ä¼¼ï¼Œåªä¸è¿‡åœ¨`promise`ä¸­å¹¶æ²¡æœ‰`resolve`æˆ–è€…`reject`
-   å› æ­¤`promise.then`å¹¶ä¸ä¼šæ‰§è¡Œï¼Œå®ƒåªæœ‰åœ¨è¢«æ”¹å˜äº†çŠ¶æ€ä¹‹åæ‰ä¼šæ‰§è¡Œã€‚

**ç­”æ¡ˆ**ï¼š1ã€2ã€4


## 4. Promise ç¬¬å››é¢˜
```js
const promise1 = new Promise((resolve, reject) => {
  console.log('promise1')
  resolve('resolve1')
})

const promise2 = promise1.then(res => {
  console.log(res)
})

console.log('1', promise1)
console.log('2', promise2)
```
**è§£æ**ï¼š
-   ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆé‡åˆ°`new Promise`ï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°ä¸­çš„ä»£ç `promise1`
-   ç¢°åˆ°`resolve`å‡½æ•°, å°†`promise1`çš„çŠ¶æ€æ”¹å˜ä¸º`resolved`, å¹¶å°†ç»“æœä¿å­˜ä¸‹æ¥
-   ç¢°åˆ°`promise1.then`è¿™ä¸ªå¾®ä»»åŠ¡ï¼Œå°†å®ƒæ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—
-   `promise2`æ˜¯ä¸€ä¸ªæ–°çš„çŠ¶æ€ä¸º`pending`çš„`Promise`
-   æ‰§è¡ŒåŒæ­¥ä»£ç 1ï¼Œ åŒæ—¶æ‰“å°å‡ºpromise1çš„çŠ¶æ€æ˜¯resolved
-   æ‰§è¡ŒåŒæ­¥ä»£ç 2ï¼ŒåŒæ—¶æ‰“å°å‡ºpromise2çš„çŠ¶æ€æ˜¯pending
-   å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ŒæŸ¥æ‰¾å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç°`promise1.then`è¿™ä¸ªå¾®ä»»åŠ¡ä¸”çŠ¶æ€ä¸º`resolved`ï¼Œæ‰§è¡Œå®ƒã€‚

**ç­”æ¡ˆ**: 
```
promise1
1 Promise { 'resolve1' }
2 Promise { <pending> }
resolve
```

## 5. Promise ç¬¬äº”é¢˜
```js
const fn = () => (new Promise((resolve, reject) => {
  console.log(1);
  resolve('success')
}))

fn().then(res => {
  console.log(res)
})

console.log('start')
```
**è§£æ**ï¼š`fn`å‡½æ•°ç›´æ¥è¿”å›äº†ä¸€ä¸ª`new Promise`çš„ï¼Œè€Œä¸”`fn`å‡½æ•°çš„è°ƒç”¨æ˜¯åœ¨`start`ä¹‹å‰ï¼Œæ‰€ä»¥å®ƒé‡Œé¢çš„å†…å®¹åº”è¯¥ä¼šå…ˆæ‰§è¡Œã€‚

**ç­”æ¡ˆ**ï¼š1ã€'start'ã€'success'

## 6. Promise ç¬¬å…­é¢˜
```js
const fn = () => {  
  return new Promise((resolve, reject) => {
    console.log(1)
    resolve('success')
  })
}

console.log('start')

fn().then(res => {
  console.log(res)
})
```
**è§£æ**ï¼šstartå°±åœ¨1ä¹‹å‰æ‰“å°å‡ºæ¥äº†ï¼Œå› ä¸ºfnå‡½æ•°æ˜¯ä¹‹åæ‰§è¡Œçš„ã€‚

æ³¨æ„ï¼šä¸è¦çœ‹åˆ°`new Promise()`ï¼Œå°±ä»¥ä¸ºæ‰§è¡Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°å‡½æ•°ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„å®ƒæ˜¯ä¸æ˜¯è¢«åŒ…è£¹åœ¨å‡½æ•°å½“ä¸­ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œåªæœ‰åœ¨å‡½æ•°è°ƒç”¨çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œã€‚

**ç­”æ¡ˆ**ï¼š"start"ã€1ã€"success"

## 7. Promise ç¬¬ä¸ƒé¢˜
```js
console.log('start')

setTimeout(() => {
  console.log('time')
})

Promise.resolve().then(() => {
  console.log('resolve')
})

console.log('end')
```
**è§£æ**ï¼š
-   åˆšå¼€å§‹æ•´ä¸ªè„šæœ¬ä½œä¸ºä¸€ä¸ªå®ä»»åŠ¡æ¥æ‰§è¡Œï¼Œå¯¹äºåŒæ­¥ä»£ç ç›´æ¥å‹å…¥æ‰§è¡Œæ ˆè¿›è¡Œæ‰§è¡Œï¼Œå› æ­¤å…ˆæ‰“å°å‡º`start`å’Œ`end`ã€‚
-   `setTimout`ä½œä¸ºä¸€ä¸ªå®ä»»åŠ¡è¢«æ”¾å…¥å®ä»»åŠ¡é˜Ÿåˆ—(ä¸‹ä¸€ä¸ª)
-   `Promise.then`ä½œä¸ºä¸€ä¸ªå¾®ä»»åŠ¡è¢«æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—
-   æœ¬æ¬¡å®ä»»åŠ¡æ‰§è¡Œå®Œï¼Œæ£€æŸ¥å¾®ä»»åŠ¡ï¼Œå‘ç°`Promise.then`ï¼Œæ‰§è¡Œå®ƒ
-   æ¥ä¸‹æ¥è¿›å…¥ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼Œå‘ç°`setTimeout`ï¼Œæ‰§è¡Œã€‚

**ç­”æ¡ˆ**ï¼š'start'ã€'end'ã€'resolve'ã€'time'

## 8. Promise ç¬¬å…«é¢˜
```js
const promise = new Promise((resolve, reject) => {
  console.log(1)
  setTimeout(() => {
    console.log('timerStart')
    resolve('success')
    console.log('timerEnd')
  }, 0)
  console.log(2)
})

promise.then(res => {
  console.log(res)
})

console.log(4)
```
**è§£æ**ï¼š
-   ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆé‡åˆ°`new Promise`ï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°ä¸­çš„ä»£ç `1`
-   ç„¶åç¢°åˆ°äº†å®šæ—¶å™¨ï¼Œå°†è¿™ä¸ªå®šæ—¶å™¨ä¸­çš„å‡½æ•°æ”¾åˆ°ä¸‹ä¸€ä¸ªå®ä»»åŠ¡çš„å»¶è¿Ÿé˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œ
-   æ‰§è¡ŒåŒæ­¥ä»£ç `2`
-   è·³å‡º`promise`å‡½æ•°ï¼Œé‡åˆ°`promise.then`ï¼Œä½†å…¶çŠ¶æ€è¿˜æ˜¯ä¸º`pending`ï¼Œè¿™é‡Œç†è§£ä¸ºå…ˆä¸æ‰§è¡Œ
-   æ‰§è¡ŒåŒæ­¥ä»£ç `4`
-   ä¸€è½®å¾ªç¯è¿‡åï¼Œè¿›å…¥ç¬¬äºŒæ¬¡å®ä»»åŠ¡ï¼Œå‘ç°å»¶è¿Ÿé˜Ÿåˆ—ä¸­æœ‰`setTimeout`å®šæ—¶å™¨ï¼Œæ‰§è¡Œå®ƒ
-   é¦–å…ˆæ‰§è¡Œ`timerStart`ï¼Œç„¶åé‡åˆ°äº†`resolve`ï¼Œå°†`promise`çš„çŠ¶æ€æ”¹ä¸º`resolved`ä¸”ä¿å­˜ç»“æœå¹¶å°†ä¹‹å‰çš„`promise.then`æ¨å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—
-   ç»§ç»­æ‰§è¡ŒåŒæ­¥ä»£ç `timerEnd`
-   å®ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼ŒæŸ¥æ‰¾å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç°`promise.then`è¿™ä¸ªå¾®ä»»åŠ¡ï¼Œæ‰§è¡Œå®ƒã€‚

**ç­”æ¡ˆ**ï¼š1ã€2ã€4ã€"timerStart"ã€"timerEnd"ã€"success"

## 9. Promise ç¬¬ä¹é¢˜
ä¸‹é¢ä¸¤æ®µä»£ç ä¼šè¾“å‡ºä»€ä¹ˆ
```js
setTimeout(() => {
  console.log('timer1')
  setTimeout(() => {
    console.log('timer3')
  }, 0)
}, 0)

setTimeout(() => {
  console.log('timer2')
}, 0)

console.log('start')
```
**ç­”æ¡ˆ**ï¼š'start'ã€'timer1'ã€'timer2'ã€'timer3'
```js
setTimeout(() => {
  console.log('timer1')
  Promise.resolve().then(() => {
    console.log('promise')
  })
}, 0)

setTimeout(() => {
  console.log('timer2')
}, 0)

console.log('start')
```
**ç­”æ¡ˆ**ï¼š'start'ã€'timer1'ã€'promise'ã€'timer2'

**è§£æ**ï¼šè¿™ä¸¤ä¸ªä¾‹å­ï¼Œçœ‹ç€å¥½åƒåªæ˜¯æŠŠç¬¬ä¸€ä¸ªå®šæ—¶å™¨ä¸­çš„å†…å®¹æ¢äº†ä¸€ä¸‹è€Œå·²ã€‚

ä¸€ä¸ªæ˜¯ä¸ºå®šæ—¶å™¨timer3ï¼Œä¸€ä¸ªæ˜¯ä¸ºPromise.then

ä½†æ˜¯å¦‚æœæ˜¯å®šæ—¶å™¨timer3çš„è¯ï¼Œå®ƒä¼šåœ¨timer2åæ‰§è¡Œï¼Œè€ŒPromise.thenå´æ˜¯åœ¨timer2ä¹‹å‰æ‰§è¡Œã€‚

ä½ å¯ä»¥è¿™æ ·ç†è§£ï¼ŒPromise.thenæ˜¯å¾®ä»»åŠ¡ï¼Œå®ƒä¼šè¢«åŠ å…¥åˆ°æœ¬è½®ä¸­çš„å¾®ä»»åŠ¡åˆ—è¡¨ï¼Œè€Œå®šæ—¶å™¨timer3æ˜¯å®ä»»åŠ¡ï¼Œå®ƒä¼šè¢«åŠ å…¥åˆ°ä¸‹ä¸€è½®çš„å®ä»»åŠ¡ä¸­ã€‚


## 10. Promise ç¬¬åé¢˜
```js
Promise.resolve().then(() => {
  console.log('promise1')
  const timer2 = setTimeout(() => {
    console.log('timer2')
  }, 0)
})

const timer1 = setTimeout(() => {
  console.log('timer1')
  Promise.resolve().then(() => {
    console.log('promise2')
  })
}, 0)

console.log('start')
```
**è§£æ**ï¼š
-   åˆšå¼€å§‹æ•´ä¸ªè„šæœ¬ä½œä¸ºç¬¬ä¸€æ¬¡å®ä»»åŠ¡æ¥æ‰§è¡Œï¼Œæˆ‘ä»¬å°†å®ƒæ ‡è®°ä¸ºå®1ï¼Œä»ä¸Šè‡³ä¸‹æ‰§è¡Œ
-   é‡åˆ°`Promise.resolve().then`è¿™ä¸ªå¾®ä»»åŠ¡ï¼Œå°†`then`ä¸­çš„å†…å®¹åŠ å…¥ç¬¬ä¸€æ¬¡çš„å¾®ä»»åŠ¡é˜Ÿåˆ—æ ‡è®°ä¸ºå¾®1
-   é‡åˆ°å®šæ—¶å™¨`timer1`ï¼Œå°†å®ƒåŠ å…¥ä¸‹ä¸€æ¬¡å®ä»»åŠ¡çš„å»¶è¿Ÿåˆ—è¡¨ï¼Œæ ‡è®°ä¸ºå®2ï¼Œç­‰å¾…æ‰§è¡Œ(å…ˆä¸ç®¡é‡Œé¢æ˜¯ä»€ä¹ˆå†…å®¹)
-   æ‰§è¡Œå®1ä¸­çš„åŒæ­¥ä»£ç `start`
-   ç¬¬ä¸€æ¬¡å®ä»»åŠ¡(å®1)æ‰§è¡Œå®Œæ¯•ï¼Œæ£€æŸ¥ç¬¬ä¸€æ¬¡çš„å¾®ä»»åŠ¡é˜Ÿåˆ—(å¾®1)ï¼Œå‘ç°æœ‰ä¸€ä¸ª`promise.then`è¿™ä¸ªå¾®ä»»åŠ¡éœ€è¦æ‰§è¡Œ
-   æ‰§è¡Œæ‰“å°å‡ºå¾®1ä¸­åŒæ­¥ä»£ç `promise1`ï¼Œç„¶åå‘ç°å®šæ—¶å™¨timer2ï¼Œå°†å®ƒåŠ å…¥å®2çš„åé¢ï¼Œæ ‡è®°ä¸ºå®3
-   ç¬¬ä¸€æ¬¡å¾®ä»»åŠ¡é˜Ÿåˆ—(å¾®1)æ‰§è¡Œå®Œæ¯•ï¼Œæ‰§è¡Œç¬¬äºŒæ¬¡å®ä»»åŠ¡(å®2)ï¼Œé¦–å…ˆæ‰§è¡ŒåŒæ­¥ä»£ç `timer1`
-   ç„¶åé‡åˆ°äº†`promise2`è¿™ä¸ªå¾®ä»»åŠ¡ï¼Œå°†å®ƒåŠ å…¥æ­¤æ¬¡å¾ªç¯çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ ‡è®°ä¸ºå¾®2
-   å®2ä¸­æ²¡æœ‰åŒæ­¥ä»£ç å¯æ‰§è¡Œäº†ï¼ŒæŸ¥æ‰¾æœ¬æ¬¡å¾ªç¯çš„å¾®ä»»åŠ¡é˜Ÿåˆ—(å¾®2)ï¼Œå‘ç°äº†`promise2`ï¼Œæ‰§è¡Œå®ƒ
-   ç¬¬äºŒè½®æ‰§è¡Œå®Œæ¯•ï¼Œæ‰§è¡Œå®3ï¼Œæ‰“å°å‡º`timer2`

**ç­”æ¡ˆ**ï¼š'start'ã€'promise1'ã€'timer1'ã€'promise2'ã€'timer2'

## 11. Promise ç¬¬åä¸€é¢˜
```js
const promise1 = new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve('success')
  }, 1000)
})

const promise2 = promise1.then(() => {
  throw new Error('error!!!')
})

console.log('promise1', promise1)
console.log('promise2', promise2)

setTimeout(() => {
  console.log('promise1', promise1)
  console.log('promise2', promise2)
}, 2000)
```
**è§£æ**ï¼š
-   ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆæ‰§è¡Œç¬¬ä¸€ä¸ª`new Promise`ä¸­çš„å‡½æ•°ï¼Œç¢°åˆ°`setTimeout`å°†å®ƒåŠ å…¥ä¸‹ä¸€ä¸ªå®ä»»åŠ¡åˆ—è¡¨
-   è·³å‡º`new Promise`ï¼Œç¢°åˆ°`promise1.then`è¿™ä¸ªå¾®ä»»åŠ¡ï¼Œä½†å…¶çŠ¶æ€è¿˜æ˜¯ä¸º`pending`ï¼Œè¿™é‡Œç†è§£ä¸ºå…ˆä¸æ‰§è¡Œ
-  ` promise2`æ˜¯ä¸€ä¸ªæ–°çš„çŠ¶æ€ä¸º`pending`çš„`Promise`
-   æ‰§è¡ŒåŒæ­¥ä»£ç `console.log('promise1')`ï¼Œä¸”æ‰“å°å‡ºçš„promise1çš„çŠ¶æ€ä¸ºpending
-   æ‰§è¡ŒåŒæ­¥ä»£ç `console.log('promise2')`ï¼Œä¸”æ‰“å°å‡ºçš„promise2çš„çŠ¶æ€ä¸ºpending
-   ç¢°åˆ°ç¬¬äºŒä¸ªå®šæ—¶å™¨ï¼Œå°†å…¶æ”¾å…¥ä¸‹ä¸€ä¸ªå®ä»»åŠ¡åˆ—è¡¨
-   ç¬¬ä¸€è½®å®ä»»åŠ¡æ‰§è¡Œç»“æŸï¼Œå¹¶ä¸”æ²¡æœ‰å¾®ä»»åŠ¡éœ€è¦æ‰§è¡Œï¼Œå› æ­¤æ‰§è¡Œç¬¬äºŒè½®å®ä»»åŠ¡
-   å…ˆæ‰§è¡Œç¬¬ä¸€ä¸ªå®šæ—¶å™¨é‡Œçš„å†…å®¹ï¼Œå°†`promise1`çš„çŠ¶æ€æ”¹ä¸ºresolvedä¸”ä¿å­˜ç»“æœå¹¶å°†ä¹‹å‰çš„`promise1.then`æ¨å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—
-   è¯¥å®šæ—¶å™¨ä¸­æ²¡æœ‰å…¶å®ƒçš„åŒæ­¥ä»£ç å¯æ‰§è¡Œï¼Œå› æ­¤æ‰§è¡Œæœ¬è½®çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯`promise1.then`ï¼Œå®ƒæŠ›å‡ºäº†ä¸€ä¸ªé”™è¯¯ï¼Œä¸”å°†`promise2`çš„çŠ¶æ€è®¾ç½®ä¸ºäº†rejected
-   ç¬¬ä¸€ä¸ªå®šæ—¶å™¨æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œç¬¬äºŒä¸ªå®šæ—¶å™¨ä¸­çš„å†…å®¹
-   æ‰“å°å‡º'promise1'ï¼Œä¸”æ­¤æ—¶promise1çš„çŠ¶æ€ä¸ºresolved
-   æ‰“å°å‡º'promise2'ï¼Œä¸”æ­¤æ—¶promise2çš„çŠ¶æ€ä¸ºrejected

**ç­”æ¡ˆ**:
```
'promise1' Promise{<pending>}
'promise2' Promise{<pending>}
UnhandledPromiseRejectionWarning: Error: error!!!
'promise1' Promise{<resolved>: "success"}
'promise2' Promise{<rejected>: Error: error!!!}
```

## 12. Promise ç¬¬åäºŒé¢˜
```js
const promise1 = new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve('success')
    console.log('timer1')
  }, 1000)
  console.log('promise1é‡Œçš„å†…å®¹')
})

const promise2 = promise1.then(() => {
  throw new Error('error!!!')
})

console.log('promise1', promise1)
console.log('promise2', promise2)

setTimeout(() => {
  console.log('timer2')
  console.log('promise1', promise1)
  console.log('promise2', promise2)
}, 2000)
```
**ç­”æ¡ˆ**ï¼šå’Œä¸Šä¸€é¢˜ç±»ä¼¼
```
'promise1é‡Œçš„å†…å®¹'
'promise1' Promise{<pending>}
'promise2' Promise{<pending>}
'timer1'
UnhandledPromiseRejectionWarning: Error: error!!!
'timer2'
'promise1' Promise{<resolved>: "success"}
'promise2' Promise{<rejected>: Error: error!!!}
```
## 13. Promise ç¬¬åä¸‰é¢˜
```js
const promise = new Promise((resolve, reject) => {
  resolve('success1')
  reject('error')
  resolve('success2')
})

promise.then(res => {
  console.log('then: ', res)
}).catch(err => {
  console.log('catch: ', err)
})
```
**è§£æ**ï¼šæ„é€ å‡½æ•°ä¸­çš„ resolve æˆ– reject åªæœ‰ç¬¬ä¸€æ¬¡æ‰§è¡Œæœ‰æ•ˆï¼Œå¤šæ¬¡è°ƒç”¨æ²¡æœ‰ä»»ä½•ä½œç”¨ ï¼ŒPromiseçš„çŠ¶æ€ä¸€ç»æ”¹å˜å°±ä¸èƒ½å†æ”¹å˜ã€‚

**ç­”æ¡ˆ**ï¼š"then: success1"

## 14. Promise ç¬¬åå››é¢˜
```js
const promise = new Promise((resolve, reject) => {
  reject('error')
  resolve('success2')
})

promise.then(res => {
  console.log('then1: ', res)
}).then(res => {
  console.log('then2: ', res)
}).catch(err => {
  console.log('catch: ', err)
}).then(res => {
  console.log('then3: ', res)
})
```
**è§£æ**ï¼š`catch`ä¸ç®¡è¢«è¿æ¥åˆ°å“ªé‡Œï¼Œéƒ½èƒ½æ•è·ä¸Šå±‚æœªæ•æ‰è¿‡çš„é”™è¯¯ã€‚

è‡³äº`then3`ä¹Ÿä¼šè¢«æ‰§è¡Œï¼Œé‚£æ˜¯å› ä¸º`catch()`ä¹Ÿä¼šè¿”å›ä¸€ä¸ªPromiseï¼Œä¸”ç”±äºè¿™ä¸ªPromiseæ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥æ‰“å°å‡ºæ¥çš„æ˜¯`undefined`ã€‚

**ç­”æ¡ˆ**ï¼š
```
catch:  error
then3:  undefined
```

## 15. Promise ç¬¬åäº”é¢˜
```js
Promise.resolve(1)
  .then(res => {
    console.log(res)
    return 2
  })
  .catch(err => {
    return 3
  })
  .then(res => {
    console.log(res)
  })
```
**è§£æ**ï¼šPromiseå¯ä»¥é“¾å¼è°ƒç”¨ï¼Œä¸è¿‡promise æ¯æ¬¡è°ƒç”¨ `.then` æˆ–è€… `.catch` éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ promiseï¼Œä»è€Œå®ç°äº†é“¾å¼è°ƒç”¨, å®ƒå¹¶ä¸åƒä¸€èˆ¬æˆ‘ä»¬ä»»åŠ¡çš„é“¾å¼è°ƒç”¨ä¸€æ ·return thisã€‚

ä¸Šé¢çš„è¾“å‡ºç»“æœä¹‹æ‰€ä»¥ä¾æ¬¡æ‰“å°å‡º1å’Œ2ï¼Œé‚£æ˜¯å› ä¸º`resolve(1)`ä¹‹åèµ°çš„æ˜¯ç¬¬ä¸€ä¸ªthenæ–¹æ³•ï¼Œå¹¶æ²¡æœ‰èµ°catché‡Œï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªthenä¸­çš„reså¾—åˆ°çš„å®é™…ä¸Šæ˜¯ç¬¬ä¸€ä¸ªthençš„è¿”å›å€¼ã€‚
ä¸”return 2ä¼šè¢«åŒ…è£…æˆ`resolve(2)`ã€‚

**ç­”æ¡ˆ**ï¼š1ã€2

## 16. Promise ç¬¬åå…­é¢˜
```js
Promise.reject(1)
  .then(res => {
    console.log(res)
    return 2
  })
  .catch(err => {
    console.log(err)
    return 3
  })
  .then(res => {
    console.log(res)
  })
```
**è§£æ**ï¼šå› ä¸ºreject(1)ï¼Œæ­¤æ—¶èµ°çš„æ˜¯catchï¼Œä¸”ç¬¬äºŒä¸ªthenä¸­çš„reså¾—åˆ°çš„å°±æ˜¯catchä¸­çš„è¿”å›å€¼ã€‚

**ç­”æ¡ˆ**ï¼š1ã€3

## 17. Promise ç¬¬åä¸ƒé¢˜
```js
const promise = new Promise((resolve, reject) => {
  setTimeout(() => {
    console.log('timer')
    resolve('success')
  }, 1000)
})

const start = Date.now()

promise.then(res => {
  console.log(res, Date.now() - start)
})

promise.then(res => {
  console.log(res, Date.now() - start)
})
```
**è§£æ**ï¼šå¦‚æœæ‰§è¡Œè¶³å¤Ÿå¿«çš„è¯ï¼Œä¹Ÿå¯èƒ½ä¸¤ä¸ªéƒ½æ˜¯1001ã€‚

Promise çš„ `.then` æˆ–è€… `.catch` å¯ä»¥è¢«è°ƒç”¨å¤šæ¬¡ï¼Œä½†è¿™é‡Œ `Promise` æ„é€ å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ã€‚æˆ–è€…è¯´ promise å†…éƒ¨çŠ¶æ€ä¸€ç»æ”¹å˜ï¼Œå¹¶ä¸”æœ‰äº†ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆåç»­æ¯æ¬¡è°ƒç”¨ `.then` æˆ–è€… `.catch` éƒ½ä¼šç›´æ¥æ‹¿åˆ°è¯¥å€¼ã€‚

**ç­”æ¡ˆ**ï¼š
```
timer
success 1024
success 1026
```

## 18. Promise ç¬¬åå…«é¢˜
```js
Promise.resolve()
  .then(() => {
    return new Error('error!!!')
  })
  .then(res => {
    console.log('then: ', res)
  })
  .catch(err => {
    console.log('catch: ', err)
  })
```
**è§£æ**ï¼šè¿”å›ä»»æ„ä¸€ä¸ªé promise çš„å€¼éƒ½ä¼šè¢«åŒ…è£¹æˆ promise å¯¹è±¡ï¼Œå› æ­¤è¿™é‡Œçš„`return new Error('error!!!')`ä¹Ÿè¢«åŒ…è£¹æˆäº†`return Promise.resolve(new Error('error!!!'))`ã€‚

**ç­”æ¡ˆ**ï¼š"then: " "Error: error!!!"

## 19. Promise ç¬¬åä¹é¢˜
```js
const promise = Promise.resolve().then(() => {
  return promise
})
promise.catch(console.err)
```
**è§£æ**ï¼š`.then` æˆ– `.catch` è¿”å›çš„å€¼ä¸èƒ½æ˜¯ promise æœ¬èº«ï¼Œå¦åˆ™ä¼šé€ æˆæ­»å¾ªç¯ï¼Œå› æ­¤ç»“æœä¼šæŠ¥é”™ã€‚

**ç­”æ¡ˆ**ï¼š
```
UnhandledPromiseRejectionWarning: TypeError: Chaining cycle detected for promise #<Promise>
```

## 20. Promise ç¬¬äºŒåé¢˜
```js
Promise.resolve(1)
  .then(2)
  .then(Promise.resolve(3))
  .then(console.log)
```
**è§£æ**ï¼š`.then` æˆ–è€… `.catch` çš„å‚æ•°æœŸæœ›æ˜¯å‡½æ•°ï¼Œä¼ å…¥éå‡½æ•°åˆ™ä¼šå‘ç”Ÿå€¼é€ä¼ ã€‚

ç¬¬ä¸€ä¸ªthenå’Œç¬¬äºŒä¸ªthenä¸­ä¼ å…¥çš„éƒ½ä¸æ˜¯å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯æ•°å­—ç±»å‹ï¼Œä¸€ä¸ªæ˜¯å¯¹è±¡ç±»å‹ï¼Œå› æ­¤å‘ç”Ÿäº†é€ä¼ ï¼Œå°†`resolve(1)` çš„å€¼ç›´æ¥ä¼ åˆ°æœ€åä¸€ä¸ªthené‡Œã€‚

**ç­”æ¡ˆ**ï¼š1

## 21. Promise ç¬¬äºŒåä¸€é¢˜
```js
Promise.reject('err!!!')
  .then(
    res => {
      console.log('success', res)
    },
    err => {
      console.log('error', err)
    }
  )
  .catch(err => {
    console.log('catch', err)
  })
```
**è§£æ**ï¼š`.then`å‡½æ•°ä¸­çš„ä¸¤ä¸ªå‚æ•°ã€‚

ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥å¤„ç†PromiseæˆåŠŸçš„å‡½æ•°ï¼Œç¬¬äºŒä¸ªåˆ™æ˜¯å¤„ç†å¤±è´¥çš„å‡½æ•°ã€‚

ä¹Ÿå°±æ˜¯è¯´Promise.resolve('1')çš„å€¼ä¼šè¿›å…¥æˆåŠŸçš„å‡½æ•°ï¼Œè€Œ`Promise.reject('err!!!')`çš„å€¼ä¼šè¿›å…¥å¤±è´¥çš„å‡½æ•°ã€‚

**ç­”æ¡ˆ**ï¼š'error' 'error!!!'

## 22. Promise ç¬¬äºŒåäºŒé¢˜
```js
Promise.resolve()
  .then(
    function success(res) {
      throw new Error('error!!!')
    },
    function fail1(err) {
      console.log('fail1', err)
    }
  )
  .catch(function fail2(err) {
    console.log('fail2', err)
  })
```
**è§£æ**ï¼šç”±äºPromiseè°ƒç”¨çš„æ˜¯`resolve()`ï¼Œå› æ­¤.`then()`æ‰§è¡Œçš„åº”è¯¥æ˜¯`success()`å‡½æ•°ï¼Œå¯æ˜¯success()å‡½æ•°æŠ›å‡ºçš„æ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œå®ƒä¼šè¢«åé¢çš„`catch()`ç»™æ•è·åˆ°ï¼Œè€Œä¸æ˜¯è¢«fail1å‡½æ•°æ•è·ã€‚

**ç­”æ¡ˆ**ï¼š
```
fail2 Error: error!!!
    at success
```

## 23. Promise ç¬¬äºŒåä¸‰é¢˜
```js
Promise.resolve('1')
  .then(res => {
    console.log(res)
  })
  .finally(() => {
    console.log('finally')
  })

Promise.resolve('2')
  .finally(() => {
    console.log('finally2')
    return 'æˆ‘æ˜¯finally2è¿”å›çš„å€¼'
  })
  .then(res => {
    console.log('finally2åé¢çš„thenå‡½æ•°', res)
  })
```
**è§£æ**ï¼š`.finally()`ï¼Œè¿™ä¸ªåŠŸèƒ½ä¸€èˆ¬ä¸å¤ªç”¨åœ¨é¢è¯•ä¸­ï¼Œä¸è¿‡å¦‚æœç¢°åˆ°äº†ä½ ä¹Ÿåº”è¯¥çŸ¥é“è¯¥å¦‚ä½•å¤„ç†ã€‚

å…¶å®åªè¦è®°ä½å®ƒä¸‰ä¸ªå¾ˆé‡è¦çš„çŸ¥è¯†ç‚¹å°±å¯ä»¥äº†ï¼š

-   `.finally()`æ–¹æ³•ä¸ç®¡Promiseå¯¹è±¡æœ€åçš„çŠ¶æ€å¦‚ä½•éƒ½ä¼šæ‰§è¡Œ
-   `.finally()`æ–¹æ³•çš„å›è°ƒå‡½æ•°ä¸æ¥å—ä»»ä½•çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ åœ¨.finally()å‡½æ•°ä¸­æ˜¯æ²¡æ³•çŸ¥é“Promiseæœ€ç»ˆçš„çŠ¶æ€æ˜¯resolvedè¿˜æ˜¯rejectedçš„
-   å®ƒæœ€ç»ˆè¿”å›çš„é»˜è®¤ä¼šæ˜¯ä¸€ä¸ªä¸Šä¸€æ¬¡çš„Promiseå¯¹è±¡å€¼ï¼Œä¸è¿‡å¦‚æœæŠ›å‡ºçš„æ˜¯ä¸€ä¸ªå¼‚å¸¸åˆ™è¿”å›å¼‚å¸¸çš„Promiseå¯¹è±¡ã€‚

ä¸Šé¢çš„ä»£ç ä¸­ï¼Œè¿™ä¸¤ä¸ªPromiseçš„.finallyéƒ½ä¼šæ‰§è¡Œï¼Œä¸”å°±ç®—finally2è¿”å›äº†æ–°çš„å€¼ï¼Œå®ƒåé¢çš„then()å‡½æ•°æ¥æ”¶åˆ°çš„ç»“æœå´è¿˜æ˜¯'2'ã€‚

**ç­”æ¡ˆ**ï¼š
```
1
finally2
finally
finally2åé¢çš„thenå‡½æ•° 2
```

## 24. Promise ç¬¬äºŒåå››é¢˜
```js
function promise1() {
  let p = new Promise(resolve => {
    console.log('promise1')
    resolve('1')
  })
  return p
}

function promise2() {
  return new Promise((resolve, reject) => {
    reject('error')
  })
}

promise1()
  .then(res => console.log(res))
  .catch(err => console.log(err))
  .finally(() => console.log('finally1'))

promise2()
  .then(res => console.log(res))
  .catch(err => console.log(err))
  .finally(() => console.log('finally2'))
```
**è§£æ**ï¼š
-   é¦–å…ˆå®šä¹‰äº†ä¸¤ä¸ªå‡½æ•°`promise1`å’Œ`promise2`ï¼Œå…ˆä¸ç®¡æ¥ç€å¾€ä¸‹çœ‹ã€‚
-   `promise1`å‡½æ•°å…ˆè¢«è°ƒç”¨äº†ï¼Œç„¶åæ‰§è¡Œé‡Œé¢`new Promise`çš„åŒæ­¥ä»£ç æ‰“å°å‡º`promise1`
-   ä¹‹åé‡åˆ°äº†`resolve(1)`ï¼Œå°†`p`çš„çŠ¶æ€æ”¹ä¸ºäº†`resolved`å¹¶å°†ç»“æœä¿å­˜ä¸‹æ¥ã€‚
-   æ­¤æ—¶`promise1`å†…çš„å‡½æ•°å†…å®¹å·²ç»æ‰§è¡Œå®Œäº†ï¼Œè·³å‡ºè¯¥å‡½æ•°
-   ç¢°åˆ°äº†`promise1().then()`ï¼Œç”±äº`promise1`çš„çŠ¶æ€å·²ç»å‘ç”Ÿäº†æ”¹å˜ä¸”ä¸º`resolved`ã€‚å› æ­¤å°†Â·promise1().then()Â·è¿™æ¡å¾®ä»»åŠ¡åŠ å…¥æœ¬è½®çš„å¾®ä»»åŠ¡åˆ—è¡¨(è¿™æ˜¯ç¬¬ä¸€ä¸ªå¾®ä»»åŠ¡)
-   è¿™æ—¶å€™è¦æ³¨æ„äº†ï¼Œä»£ç å¹¶ä¸ä¼šæ¥ç€å¾€é“¾å¼è°ƒç”¨çš„ä¸‹é¢èµ°ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šå…ˆå°†`.finally`åŠ å…¥å¾®ä»»åŠ¡åˆ—è¡¨ï¼Œé‚£æ˜¯å› ä¸º`.then`æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¾®ä»»åŠ¡ï¼Œå®ƒé“¾å¼åé¢çš„å†…å®¹å¿…é¡»å¾—ç­‰å½“å‰è¿™ä¸ªå¾®ä»»åŠ¡æ‰§è¡Œå®Œæ‰ä¼šæ‰§è¡Œï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬å…ˆä¸ç®¡`.finally()`
-   å†å¾€ä¸‹èµ°ç¢°åˆ°äº†`promise2()`å‡½æ•°ï¼Œå…¶ä¸­è¿”å›çš„`new Promise`ä¸­å¹¶æ²¡æœ‰åŒæ­¥ä»£ç éœ€è¦æ‰§è¡Œï¼Œæ‰€ä»¥æ‰§è¡Œ`reject('error')`çš„æ—¶å€™å°†`promise2`å‡½æ•°ä¸­çš„`Promise`çš„çŠ¶æ€å˜ä¸ºäº†`rejected`
-   è·³å‡º`promise2`å‡½æ•°ï¼Œé‡åˆ°äº†`promise2().catch()`ï¼Œå°†å…¶åŠ å…¥å½“å‰çš„å¾®ä»»åŠ¡é˜Ÿåˆ—(è¿™æ˜¯ç¬¬äºŒä¸ªå¾®ä»»åŠ¡)ï¼Œä¸”é“¾å¼è°ƒç”¨åé¢çš„å†…å®¹å¾—ç­‰è¯¥ä»»åŠ¡æ‰§è¡Œå®Œåæ‰æ‰§è¡Œï¼Œå’Œ`.then()`ä¸€æ ·ã€‚
-   æœ¬è½®çš„å®ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œäº†ï¼Œæ¥çœ‹çœ‹å¾®ä»»åŠ¡åˆ—è¡¨ï¼Œå­˜åœ¨`promise1().then()`ï¼Œæ‰§è¡Œå®ƒï¼Œæ‰“å°å‡º1ï¼Œç„¶åé‡åˆ°äº†`.finally()`è¿™ä¸ªå¾®ä»»åŠ¡å°†å®ƒåŠ å…¥å¾®ä»»åŠ¡åˆ—è¡¨(è¿™æ˜¯ç¬¬ä¸‰ä¸ªå¾®ä»»åŠ¡)ç­‰å¾…æ‰§è¡Œ
-   å†æ‰§è¡Œ`promise2().catch()`æ‰“å°å‡º`error`ï¼Œæ‰§è¡Œå®Œåå°†`finally2`åŠ å…¥å¾®ä»»åŠ¡åŠ å…¥å¾®ä»»åŠ¡åˆ—è¡¨(è¿™æ˜¯ç¬¬å››ä¸ªå¾®ä»»åŠ¡)
-   æœ¬è½®åˆå…¨éƒ¨æ‰§è¡Œå®Œäº†ï¼Œä½†æ˜¯å¾®ä»»åŠ¡åˆ—è¡¨è¿˜æœ‰ä¸¤ä¸ªæ–°çš„å¾®ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œï¼Œå› æ­¤ä¾æ¬¡æ‰§è¡Œ`finally1`å’Œ`finally2`ã€‚

**ç­”æ¡ˆ**ï¼š
```
promise1
1
error
finally1
finally2
```

## 25. Promise ç¬¬äºŒåäº”é¢˜
```js
function runAsync(x) {
  const p = new Promise(r => {
    setTimeout(() => {
      r(x, console.log(x))
    }, 1000)
  })
  return p
}

Promise.all([runAsync(1), runAsync(2), runAsync(3)]).then(res => {
  console.log(res)
})
```
**è§£æ**ï¼š`.all()`çš„ä½œç”¨æ˜¯æ¥æ”¶ä¸€ç»„å¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åå¹¶è¡Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œåæ‰æ‰§è¡Œå›è°ƒã€‚

**ç­”æ¡ˆ**ï¼š1ã€2ã€3ã€[1, 2, 3]

## 26. Promise ç¬¬äºŒåå…­é¢˜
```js
function runAsync(x) {
  const p = new Promise( r => {
    setTimeout(() => {
      r(x, console.log(x))
    }, 1000)
  })
  return p
}
function runReject(x) {
  const p = new Promise((res, rej) =>
    setTimeout(() => {
      rej(`Error: ${x}`, console.log(x))
    }, 1000 * x)
  )
  return p
}
Promise.all([runAsync(1), runReject(4), runAsync(3), runReject(2)])
  .then(res => console.log(res))
  .catch(err => console.log(err))
```
**è§£æ**ï¼š`.catch`æ˜¯ä¼šæ•è·æœ€å…ˆçš„é‚£ä¸ªå¼‚å¸¸ï¼Œåœ¨è¿™é“é¢˜ç›®ä¸­æœ€å…ˆçš„å¼‚å¸¸å°±æ˜¯`runReject(2)`çš„ç»“æœã€‚

**ç­”æ¡ˆ**ï¼š
```
// 1såè¾“å‡º
1 
3 
// 2såè¾“å‡º 
2 
Error: 2 
// 4såè¾“å‡º 
4
```

## 27. Promise ç¬¬äºŒåä¸ƒé¢˜
```js
function runAsync(x) {
  const p = new Promise(r => {
    setTimeout(() => {
      r(x, console.log(x))
    }, 1000)
  })
  return p
}
function runReject(x) {
  const p = new Promise((res, rej) =>
    setTimeout(() => {
      rej(`Error: ${x}`, console.log(x))
    }, 1000 * x)
  )
  return p
}
Promise.race([runReject(0), runAsync(1), runAsync(2), runAsync(3)])
  .then(res => console.log('result: ', res))
  .catch(err => console.log(err))
```
**è§£æ**ï¼š`.race()`çš„ä½œç”¨ä¹Ÿæ˜¯æ¥æ”¶ä¸€ç»„å¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åå¹¶è¡Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œåªä¿ç•™å–ç¬¬ä¸€ä¸ªæ‰§è¡Œå®Œæˆçš„å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå…¶ä»–çš„æ–¹æ³•ä»åœ¨æ‰§è¡Œï¼Œä¸è¿‡æ‰§è¡Œç»“æœä¼šè¢«æŠ›å¼ƒã€‚

**ç­”æ¡ˆ**ï¼š
```
0
Error: 0
1
2
3
```

## 28. Promise ç¬¬äºŒåå…«é¢˜
```js
async function async1() {
  console.log('async1 start')
  await async2()
  console.log('async1 end')
}

async function async2() {
  console.log('async2')
}

async1()

console.log('start')
```
**è§£æ**ï¼š
-   é¦–å…ˆä¸€è¿›æ¥æ˜¯åˆ›å»ºäº†ä¸¤ä¸ªå‡½æ•°çš„ï¼Œæˆ‘ä»¬å…ˆä¸çœ‹å‡½æ•°çš„åˆ›å»ºä½ç½®ï¼Œè€Œæ˜¯çœ‹å®ƒçš„è°ƒç”¨ä½ç½®
-   å‘ç°`async1`å‡½æ•°è¢«è°ƒç”¨äº†ï¼Œç„¶åå»çœ‹çœ‹è°ƒç”¨çš„å†…å®¹
-   æ‰§è¡Œå‡½æ•°ä¸­çš„åŒæ­¥ä»£ç `async1 start`ï¼Œä¹‹åç¢°åˆ°äº†awaitï¼Œå®ƒä¼šé˜»å¡async1åé¢ä»£ç çš„æ‰§è¡Œï¼Œå› æ­¤ä¼šå…ˆå»æ‰§è¡Œ`async2`ä¸­çš„åŒæ­¥ä»£ç async2ï¼Œç„¶åè·³å‡º`async1`
-   è·³å‡ºasync1å‡½æ•°åï¼Œæ‰§è¡ŒåŒæ­¥ä»£ç start
-   åœ¨ä¸€è½®å®ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œä¹‹åï¼Œå†æ¥æ‰§è¡Œåˆšåˆšawaitåé¢çš„å†…å®¹`async1 end`ã€‚

åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥ç†è§£ä¸ºã€Œç´§è·Ÿç€awaitåé¢çš„è¯­å¥ç›¸å½“äºæ”¾åˆ°äº†`new Promise`ä¸­ï¼Œä¸‹ä¸€è¡ŒåŠä¹‹åçš„è¯­å¥ç›¸å½“äºæ”¾åœ¨`Promise.then`ä¸­ã€ã€‚

**ç­”æ¡ˆ**ï¼š
```
async1 start
async2
start
async1 end
```

## 29. Promise ç¬¬äºŒåä¹é¢˜
```js
async function async1() {
  console.log('async1 start')
  await async2()
  console.log('async1 end')
}
async function async2() {
  setTimeout(() => {
    console.log('timer')
  }, 0)
  console.log('async2')
}
async1()
console.log('start')
```
**è§£æ**:å®šæ—¶å™¨å§‹ç»ˆè¿˜æ˜¯æœ€åæ‰§è¡Œçš„ï¼Œå®ƒè¢«æ”¾åˆ°ä¸‹ä¸€æ¡å®ä»»åŠ¡çš„å»¶è¿Ÿé˜Ÿåˆ—ä¸­ã€‚

**ç­”æ¡ˆ**ï¼š
```
async1 start
async2
start
async1 end
timer
```

## 30. Promise ç¬¬ä¸‰åé¢˜
```js
async function async1() {
  console.log('async1 start')
  await async2()
  console.log('async1 end')
  setTimeout(() => {
    console.log('timer1')
  }, 0)
}

async function async2() {
  setTimeout(() => {
    console.log('timer2')
  }, 0)
  console.log('async2')
}

async1()

setTimeout(() => {
  console.log('timer3')
}, 0)

console.log('start')
```
**è§£æ**ï¼šä¸ç®¡å®šæ—¶å™¨è°å…ˆæ‰§è¡Œï¼Œä½ åªéœ€è¦å…³æ³¨è°å…ˆè¢«è°ƒç”¨çš„ä»¥åŠå»¶è¿Ÿæ—¶é—´æ˜¯å¤šå°‘ï¼Œè¿™é“é¢˜ä¸­å»¶è¿Ÿæ—¶é—´éƒ½æ˜¯0ï¼Œæ‰€ä»¥åªè¦å…³æ³¨è°å…ˆè¢«è°ƒç”¨çš„ã€‚

**ç­”æ¡ˆ**ï¼š
```
async1 start
async2
start
async1 end
timer2
timer3
timer1
```


## 31. Promise ç¬¬ä¸‰åä¸€é¢˜
```js
async function fn () {
  // return await 1234
  // ç­‰åŒäº
  return 123
}
fn().then(res => console.log(res))
````
**è§£æ**ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œasyncä¸­çš„awaitå‘½ä»¤æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œè¿”å›è¯¥å¯¹è±¡çš„ç»“æœã€‚

ä½†å¦‚æœä¸æ˜¯Promiseå¯¹è±¡çš„è¯ï¼Œå°±ä¼šç›´æ¥è¿”å›å¯¹åº”çš„å€¼ï¼Œç›¸å½“äº`Promise.resolve()`

**ç­”æ¡ˆ**ï¼š123

## 32. Promise ç¬¬ä¸‰åäºŒé¢˜
```js
async function async1() {
  console.log('async1 start')
  await new Promise(resolve => {
    console.log('promise1')
  })
  console.log('async1 success')
  return 'async1 end'
}

console.log('srcipt start')

async1().then(res => console.log(res))

console.log('srcipt end')
```
**è§£æ**ï¼šåœ¨async1ä¸­awaitåé¢çš„Promiseæ˜¯æ²¡æœ‰è¿”å›å€¼çš„ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„çŠ¶æ€å§‹ç»ˆæ˜¯pendingçŠ¶æ€ï¼Œå› æ­¤ç›¸å½“äºä¸€ç›´åœ¨awaitï¼Œawaitï¼Œawaitå´å§‹ç»ˆæ²¡æœ‰å“åº”...

æ‰€ä»¥åœ¨awaitä¹‹åçš„å†…å®¹æ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œä¹ŸåŒ…æ‹¬async1åé¢çš„ .thenã€‚

**ç­”æ¡ˆ**ï¼š
```
srcipt start
async1 start
promise1
srcipt end
```

## 33. Promise ç¬¬ä¸‰åä¸‰é¢˜
```js
async function async1() {
  console.log('async1 start')
  await new Promise(resolve => {
    console.log('promise1')
    resolve('promise resolve')
  })
  console.log('async1 success')
  return 'async1 end'
}

console.log('srcipt start')

async1().then(res => {
  console.log(res)
})

new Promise(resolve => {
  console.log('promise2')
  setTimeout(() => {
    console.log('timer')
  })
})
```
**è§£æ**ï¼šè¿™é“é¢˜ä¹Ÿä¸éš¾ï¼Œä¸è¿‡æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„ï¼Œåœ¨async1ä¸­çš„`new Promise`Â resovleçš„å€¼ï¼Œå’Œ`async1().then()`é‡Œçš„å€¼æ˜¯æ²¡æœ‰å…³ç³»çš„ï¼Œå¾ˆå¤šå°ä¼™ä¼´å¯èƒ½çœ‹åˆ°`resovle('promise resolve')`å°±ä¼šè¯¯ä»¥ä¸ºæ˜¯`async1().then()`ä¸­çš„è¿”å›å€¼ã€‚

**ç­”æ¡ˆ**ï¼š
```
srcipt start
async1 start
promise1
promise2
async1 success
async1 end
timer
```


## 34. Promise ç¬¬ä¸‰åå››é¢˜
```js
async function async1() {
  console.log('async1 start')
  await async2()
  console.log('async1 end')
}

async function async2() {
  console.log('async2')
}

console.log('script start')

setTimeout(function() {
  console.log('setTimeout')
}, 0)

async1()

new Promise(function(resolve) {
  console.log('promise1')
  resolve()
}).then(function() {
  console.log('promise2')
})
console.log('script end')
```
**è§£æ**ï¼šç»è¿‡å‰é¢çš„é¢˜ç›®è§£æï¼Œç›¸ä¿¡è¿™é“é¢˜å¯ä»¥å¾ˆå®¹æ˜“å¾—å‡ºç»“æœã€‚

**ç­”æ¡ˆ**ï¼š
```
script start
async1 start
async2
promise1
script end
async1 end
promise2
setTimeout
```

## 35. Promise ç¬¬ä¸‰åäº”é¢˜
```js
async function testSometing() {
  console.log('æ‰§è¡ŒtestSometing')
  return 'testSometing'
}

async function testAsync() {
  console.log('æ‰§è¡ŒtestAsync')
  return Promise.resolve('hello async')
}

async function test() {
  console.log('test start...')
  const v1 = await testSometing()
  console.log(v1)
  const v2 = await testAsync()
  console.log(v2)
  console.log(v1, v2)
}

test()

var promise = new Promise(resolve => {
  console.log('promise start...')
  resolve('promise')
})
promise.then(val => console.log(val))

console.log('test end...')
```
**è§£æ**ï¼šè¿™é‡Œç›´ç»™å‡ºç­”æ¡ˆ

**ç­”æ¡ˆ**ï¼š
```
test start...
æ‰§è¡ŒtestSometing
promise start...
test end...
testSometing
æ‰§è¡ŒtestAsync
promise
hello async
testSometing hello async
```

## 36. Promise ç¬¬ä¸‰åå…­é¢˜
```js
async function async1() {
  await async2()
  console.log('async1')
  return 'async1 success'
}
async function async2() {
  return new Promise((resolve, reject) => {
    console.log('async2')
    reject('error')
  })
}
async1().then(res => console.log(res))
```
**è§£æ**ï¼šç›´æ¥ç»™å‡ºç­”æ¡ˆ
**ç­”æ¡ˆ**ï¼š
```
async2
(node:10244) UnhandledPromiseRejectionWarning: error
```

## 37. Promise ç¬¬ä¸‰åä¸ƒé¢˜
```js
async function async1() {
  try {
    await Promise.reject('error!!!')
  } catch (e) {
    console.log(e)
  }
  console.log('async1')
  return Promise.resolve('async1 success')
}
async1().then(res => console.log(res))
console.log('script start')
```
**è§£æ**ï¼šç›´æ¥ç»™å‡ºç­”æ¡ˆ

**ç­”æ¡ˆ**ï¼š
```
script start
error!!!
async1
async1 success
```


## 38. Promise ç¬¬ä¸‰åå…«é¢˜
```js
const first = () =>
  new Promise((resolve, reject) => {
    console.log(3)
    let p = new Promise((resolve, reject) => {
      console.log(7)
      setTimeout(() => {
        console.log(5)
        resolve(6)
        console.log(p)
      }, 0)
      resolve(1)
    })
    resolve(2)
    p.then(arg => {
      console.log(arg)
    })
  })
first().then(arg => {
  console.log(arg)
})
console.log(4)
```
**è§£æ**ï¼š
-   ç¬¬ä¸€æ®µä»£ç å®šä¹‰çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—çœ‹çœ‹å®ƒæ˜¯åœ¨å“ªæ‰§è¡Œçš„ï¼Œå‘ç°å®ƒåœ¨4ä¹‹å‰ï¼Œæ‰€ä»¥å¯ä»¥æ¥çœ‹çœ‹firstå‡½æ•°é‡Œé¢çš„å†…å®¹äº†ã€‚
-   å‡½æ•°firstè¿”å›çš„æ˜¯ä¸€ä¸ª`new Promise()`ï¼Œå› æ­¤å…ˆæ‰§è¡Œé‡Œé¢çš„åŒæ­¥ä»£ç 3
-   æ¥ç€åˆé‡åˆ°äº†ä¸€ä¸ª`new Promise()`ï¼Œç›´æ¥æ‰§è¡Œé‡Œé¢çš„åŒæ­¥ä»£ç 7
-   æ‰§è¡Œå®Œ7ä¹‹åï¼Œåœ¨pä¸­ï¼Œé‡åˆ°äº†ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå…ˆå°†å®ƒæ”¾åˆ°ä¸‹ä¸€ä¸ªå®ä»»åŠ¡é˜Ÿåˆ—é‡Œä¸ç®¡å®ƒï¼Œæ¥ç€å‘ä¸‹èµ°
-   ç¢°åˆ°äº†`resolve(1)`ï¼Œè¿™é‡Œå°±æŠŠpçš„çŠ¶æ€æ”¹ä¸ºäº†resolvedï¼Œä¸”è¿”å›å€¼ä¸º1ï¼Œä¸è¿‡è¿™é‡Œä¹Ÿå…ˆä¸æ‰§è¡Œ
-   è·³å‡ºpï¼Œç¢°åˆ°äº†`resolve(2)`ï¼Œè¿™é‡Œçš„`resolve(2)`ï¼Œè¡¨ç¤ºçš„æ˜¯æŠŠfirstå‡½æ•°è¿”å›çš„é‚£ä¸ªPromiseçš„çŠ¶æ€æ”¹äº†ï¼Œä¹Ÿå…ˆä¸ç®¡å®ƒã€‚
-   ç„¶åç¢°åˆ°äº†`p.then`ï¼Œå°†å®ƒåŠ å…¥æœ¬æ¬¡å¾ªç¯çš„å¾®ä»»åŠ¡åˆ—è¡¨ï¼Œç­‰å¾…æ‰§è¡Œ
-   è·³å‡ºfirstå‡½æ•°ï¼Œé‡åˆ°äº†`first().then()`ï¼Œå°†å®ƒåŠ å…¥æœ¬æ¬¡å¾ªç¯çš„å¾®ä»»åŠ¡åˆ—è¡¨(p.thençš„åé¢æ‰§è¡Œ)
-   ç„¶åæ‰§è¡ŒåŒæ­¥ä»£ç 4
-   æœ¬è½®çš„åŒæ­¥ä»£ç å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼ŒæŸ¥æ‰¾å¾®ä»»åŠ¡åˆ—è¡¨ï¼Œå‘ç°`p.then`å’Œ`first().then()`ï¼Œä¾æ¬¡æ‰§è¡Œï¼Œæ‰“å°å‡º1å’Œ2
-   æœ¬è½®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•äº†ï¼Œå‘ç°è¿˜æœ‰ä¸€ä¸ªå®šæ—¶å™¨æ²¡æœ‰è·‘å®Œï¼Œæ¥ç€æ‰§è¡Œè¿™ä¸ªå®šæ—¶å™¨é‡Œçš„å†…å®¹ï¼Œæ‰§è¡ŒåŒæ­¥ä»£ç 5
-   ç„¶ååˆé‡åˆ°äº†ä¸€ä¸ªresolve(6)ï¼Œå®ƒæ˜¯æ”¾åœ¨pé‡Œçš„ï¼Œä½†æ˜¯pçš„çŠ¶æ€åœ¨ä¹‹å‰å·²ç»å‘ç”Ÿè¿‡æ”¹å˜äº†ï¼Œå› æ­¤è¿™é‡Œå°±ä¸ä¼šå†æ”¹å˜ï¼Œä¹Ÿå°±æ˜¯è¯´resolve(6)ç›¸å½“äºæ²¡ä»»ä½•ç”¨å¤„ï¼Œå› æ­¤æ‰“å°å‡ºæ¥çš„pä¸º`Promise{<resolved>: 1}`ã€‚

**ç­”æ¡ˆ**ï¼š
```
3
7
4
1
2
5
Promise { 1 }
```

## 39. Promise ç¬¬ä¸‰åä¹é¢˜
```js
const async1 = async () => {
  console.log('async1')
  setTimeout(() => {
    console.log('timer1')
  }, 2000)
  await new Promise(resolve => {
    console.log('promise1')
  })
  console.log('async1 end')
  return 'async1 success'
}
console.log('script start')
async1().then(res => console.log(res))
console.log('script end')
Promise.resolve(1)
  .then(2)
  .then(Promise.resolve(3))
  .catch(4)
  .then(res => console.log(res))
setTimeout(() => {
  console.log('timer2')
}, 1000)
```
**è§£æ**ï¼šéœ€è¦æ³¨æ„çš„ç‚¹ï¼š

-   asyncå‡½æ•°ä¸­awaitçš„`new Promise`è¦æ˜¯æ²¡æœ‰è¿”å›å€¼çš„è¯åˆ™ä¸æ‰§è¡Œåé¢çš„å†…å®¹
-   .thenå‡½æ•°ä¸­çš„å‚æ•°æœŸå¾…çš„æ˜¯å‡½æ•°ï¼Œå¦‚æœä¸æ˜¯å‡½æ•°çš„è¯ä¼šå‘ç”Ÿé€ä¼ 
-   æ³¨æ„å®šæ—¶å™¨çš„å»¶è¿Ÿæ—¶é—´

**ç­”æ¡ˆ**ï¼š
```
script start
async1    
promise1  
script end
1
timer2
timer1
```

## 40. Promise ç¬¬å››åé¢˜
```js
const p1 = new Promise(resolve => {
  setTimeout(() => {
    resolve('resolve3')
    console.log('timer1')
      }, 0)
  resolve('resovle1')
  resolve('resolve2')
})
  .then(res => {
    console.log(res)
    setTimeout(() => {
      console.log(p1)
    }, 1000)
  })
  .finally(res => {
    console.log('finally', res)
  })
```
**è§£æ**ï¼š
-   Promiseçš„çŠ¶æ€ä¸€æ—¦æ”¹å˜å°±æ— æ³•æ”¹å˜
-   finallyä¸ç®¡Promiseçš„çŠ¶æ€æ˜¯`resolved`è¿˜æ˜¯`rejected`éƒ½ä¼šæ‰§è¡Œï¼Œä¸”å®ƒçš„å›è°ƒå‡½æ•°æ˜¯æ¥æ”¶ä¸åˆ°Promiseçš„ç»“æœçš„ï¼Œæ‰€ä»¥finally()ä¸­çš„resæ˜¯ä¸€ä¸ªè¿·æƒ‘é¡¹ã€‚
-   æœ€åä¸€ä¸ªå®šæ—¶å™¨æ‰“å°å‡ºçš„p1å…¶å®æ˜¯`.finally`çš„è¿”å›å€¼ï¼Œæˆ‘ä»¬çŸ¥é“`.finally`çš„è¿”å›å€¼å¦‚æœåœ¨æ²¡æœ‰æŠ›å‡ºé”™è¯¯çš„æƒ…å†µä¸‹é»˜è®¤ä¼šæ˜¯ä¸Šä¸€ä¸ªPromiseçš„è¿”å›å€¼ï¼Œè€Œè¿™é“é¢˜ä¸­`.finally`ä¸Šä¸€ä¸ªPromiseæ˜¯`.then()`ï¼Œä½†æ˜¯è¿™ä¸ª`.then()`å¹¶æ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥p1æ‰“å°å‡ºæ¥çš„Promiseçš„å€¼ä¼šæ˜¯`undefined`ï¼Œå¦‚æœä½ åœ¨å®šæ—¶å™¨çš„ä¸‹é¢åŠ ä¸Šä¸€ä¸ª`return 1`ï¼Œåˆ™å€¼å°±ä¼šå˜æˆ1ã€‚

**ç­”æ¡ˆ**ï¼š
```
resovle1
finally undefined
timer1
Promise { undefined }
```

> æ¯æ–‡ä¸€å¥ï¼šä¸€ä¸ªèƒ½æ€è€ƒçš„äººï¼Œæ‰çœŸæ˜¯ä¸€ä¸ªåŠ›é‡æ— è¾¹çš„äººã€‚â€”â€”å·´å°”æ‰å…‹

